<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMJK Notre Dame Convent - Semakan Keputusan Peperiksaan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a4e8a;
            --secondary-color: #e6a823;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .school-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .school-title {
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .school-logo, .ts25-logo {
            height: 80px;
            width: auto;
            max-width: 100%;
            object-fit: contain;
        }
        
        @media (max-width: 768px) {
            .logo-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .school-logo, .ts25-logo {
                height: 60px;
            }
        }
        
        .login-container, .results-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #0d3a6e;
            border-color: #0d3a6e;
        }
        
        .subject-card {
            border-left: 4px solid var(--primary-color);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .subject-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .analysis-card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .exam-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .student-info {
            background-color: var(--light-color);
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1.5rem;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .container {
                width: 100% !important;
                max-width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .results-container, .subject-card, .analysis-card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- School Header -->
    <header class="school-header text-center">
        <div class="container">
            <div class="logo-container">
                <!-- 校徽 - 使用GitHub托管的图片 -->
                <img src="https://raw.githubusercontent.com/[YOUR_USERNAME]/[YOUR_REPO]/main/images/notre-dame-logo.png" 
                     alt="SMJK Notre Dame Convent Logo" 
                     class="school-logo"
                     onerror="this.src='https://via.placeholder.com/80x80?text=NDC+Logo'">
                
                <div>
                    <h1 class="school-title">SMJK NOTRE DAME CONVENT MELAKA</h1>
                </div>
                
                <!-- TS25徽章 - 使用GitHub托管的图片 -->
                <img src="https://raw.githubusercontent.com/[YOUR_USERNAME]/[YOUR_REPO]/main/images/ts25-logo.png" 
                     alt="TS25 Logo" 
                     class="ts25-logo"
                     onerror="this.src='https://via.placeholder.com/80x80?text=TS25+Logo'">
            </div>
            <h2 class="mt-3">SEMAKAN KEPUTUSAN PEPERIKSAAN</h2>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Login Section -->
        <section id="loginSection" class="login-container">
            <h3 class="text-center mb-4"><i class="fas fa-lock"></i> Sistem Log Masuk Pelajar</h3>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="userId" class="form-label">ID Pengguna</label>
                            <input type="text" class="form-control" id="userId" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Kata Laluan</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Log Masuk</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- IC Input Section (Hidden Initially) -->
        <section id="icSection" class="login-container" style="display: none;">
            <h3 class="text-center mb-4"><i class="fas fa-user-graduate"></i> Sila Masukkan Nombor Kad Pengenalan</h3>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <form id="icForm">
                        <div class="mb-3">
                            <label for="icNumber" class="form-label">Nombor IC (Tanpa '-'):</label>
                            <input type="text" class="form-control" id="icNumber" placeholder="Contoh: 010101010101" required>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Semak Keputusan</button>
                            <button type="button" id="logoutBtn" class="btn btn-secondary"><i class="fas fa-sign-out-alt"></i> Log Keluar</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Results Section (Hidden Initially) -->
        <section id="resultsSection" class="results-container" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="exam-title mb-0"><i class="fas fa-award"></i> Keputusan Peperiksaan</h3>
                <button id="printBtn" class="btn btn-primary no-print"><i class="fas fa-file-pdf"></i> Eksport PDF</button>
            </div>
            
            <!-- Student Info -->
            <div id="studentInfo" class="student-info">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Nama Pelajar:</strong> <span id="studentName"></span></p>
                        <p><strong>Kelas:</strong> <span id="studentClass"></span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>No. Kad Pengenalan:</strong> <span id="studentIc"></span></p>
                    </div>
                </div>
            </div>
            
            <!-- Subjects Results -->
            <h4 class="mt-4 mb-3"><i class="fas fa-book-open"></i> Keputusan Mata Pelajaran</h4>
            <div id="subjectsContainer" class="row">
                <!-- Subjects will be populated here by JavaScript -->
            </div>
            
            <!-- Analysis -->
            <h4 class="mt-5 mb-3"><i class="fas fa-chart-bar"></i> Analisis Keputusan</h4>
            <div id="analysisContainer" class="row">
                <!-- Analysis will be populated here by JavaScript -->
            </div>
            
            <div class="d-grid gap-2 mt-4 no-print">
                <button id="backBtn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Kembali</button>
            </div>
        </section>
    </main>

        <!-- Footer -->
    <footer class="footer">
        <div class="container text-center">
            <div class="row">
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5>Hubungi Kami</h5>
                    <p>SMJK Notre Dame Convent Melaka<br>
                    265 Jalan Gajah Berang,<br>
                    75200 Melaka</p>
                </div>
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5>Maklumat Sekolah</h5>
                    <p><i class="fas fa-phone"></i> 06-282 4887<br>
                    <i class="fas fa-envelope"></i> meb2100@moe.edu.my</p>
                </div>
                <div class="col-md-4">
                    <h5>Waktu Operasi</h5>
                    <p>Isnin - Jumaat<br>
                    7:30 pagi - 4:00 petang</p>
                </div>
            </div>
            <hr class="my-4 bg-light">
            <p class="mb-0">Cipta © cpl 2025. Hak Cipta Terpelihara.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Correct credentials
        const CORRECT_ID = "SMJKNDC";
        const CORRECT_PASSWORD = "meb2100";
        
        // GitHub Raw CSV data URL - 替换为您的GitHub CSV文件URL
        const GITHUB_CSV_URL = "https://raw.githubusercontent.com/[YOUR_USERNAME]/[YOUR_REPO]/main/data/student_results.csv";
        
        // Global variable to store student data
        let allStudentsData = [];
        let currentStudent = null;
        
        // DOM elements
        const loginSection = document.getElementById('loginSection');
        const icSection = document.getElementById('icSection');
        const resultsSection = document.getElementById('resultsSection');
        const loginForm = document.getElementById('loginForm');
        const icForm = document.getElementById('icForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const backBtn = document.getElementById('backBtn');
        const printBtn = document.getElementById('printBtn');
        
        // Event listeners
        loginForm.addEventListener('submit', handleLogin);
        icForm.addEventListener('submit', handleIcSubmit);
        logoutBtn.addEventListener('click', logout);
        backBtn.addEventListener('click', () => {
            resultsSection.style.display = 'none';
            icSection.style.display = 'block';
        });
        printBtn.addEventListener('click', generatePDF);
        
        // Fetch student data when the page loads
        window.addEventListener('DOMContentLoaded', fetchStudentData);
        
        // Function to fetch student data from GitHub
        async function fetchStudentData() {
            try {
                const response = await fetch(GITHUB_CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvData = await response.text();
                allStudentsData = parseCSV(csvData);
                console.log('Student data loaded:', allStudentsData);
            } catch (error) {
                console.error('Error fetching student data:', error);
                alert('Ralat: Tidak dapat memuatkan data pelajar. Sila cuba lagi nanti.');
            }
        }
        
        // Function to parse CSV data
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i] || lines[i].trim() === '') continue;
                
                const obj = {};
                const currentLine = lines[i].split(',');
                
                for (let j = 0; j < headers.length; j++) {
                    const header = headers[j].trim();
                    obj[header] = currentLine[j] ? currentLine[j].trim() : '';
                }
                
                result.push(obj);
            }
            
            return result;
        }
        
        // Function to handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;
            
            if (userId === CORRECT_ID && password === CORRECT_PASSWORD) {
                loginSection.style.display = 'none';
                icSection.style.display = 'block';
            } else {
                alert('ID Pengguna atau Kata Laluan tidak tepat. Sila cuba lagi.');
            }
        }
        
        // Function to handle IC submission
        function handleIcSubmit(e) {
            e.preventDefault();
            
            const icNumber = document.getElementById('icNumber').value.trim();
            
            if (!icNumber) {
                alert('Sila masukkan nombor kad pengenalan anda.');
                return;
            }
            
            // Find student by IC number (column B)
            currentStudent = allStudentsData.find(student => student.B === icNumber);
            
            if (currentStudent) {
                displayStudentResults(currentStudent);
                icSection.style.display = 'none';
                resultsSection.style.display = 'block';
            } else {
                alert('Tiada rekod ditemui untuk nombor IC yang dimasukkan. Sila semak dan cuba lagi.');
            }
        }
        
        // Function to display student results
        function displayStudentResults(student) {
            // Display basic info
            document.getElementById('studentName').textContent = student.C || 'N/A';
            document.getElementById('studentClass').textContent = student.D || 'N/A';
            document.getElementById('studentIc').textContent = student.B || 'N/A';
            
            // Display subjects
            const subjectsContainer = document.getElementById('subjectsContainer');
            subjectsContainer.innerHTML = '';
            
            const subjects = [
                { name: 'Bahasa Melayu', scoreCol: 'E', gradeCol: 'F' },
                { name: 'Sejarah', scoreCol: 'G', gradeCol: 'H' },
                { name: 'Bahasa Inggeris', scoreCol: 'I', gradeCol: 'J' },
                { name: 'Pendidikan Islam', scoreCol: 'K', gradeCol: 'L' },
                { name: 'Pendidikan Moral', scoreCol: 'M', gradeCol: 'N' },
                { name: 'Bahasa Cina', scoreCol: 'AA', gradeCol: 'AB' },
                { name: 'Bahasa Tamil', scoreCol: 'AC', gradeCol: 'AD' },
                { name: 'Matematik', scoreCol: 'O', gradeCol: 'P' },
                { name: 'Sains', scoreCol: 'Y', gradeCol: 'Z' },
                { name: 'Fizik', scoreCol: 'Q', gradeCol: 'R' },
                { name: 'Kimia', scoreCol: 'S', gradeCol: 'T' },
                { name: 'Biologi', scoreCol: 'U', gradeCol: 'V' },
                { name: 'Matematik Tambahan', scoreCol: 'W', gradeCol: 'X' },
                { name: 'Ekonomi', scoreCol: 'AE', gradeCol: 'AF' },
                { name: 'Prinsip Perakaunan', scoreCol: 'AI', gradeCol: 'AJ' },
                { name: 'Perniagaan', scoreCol: 'AK', gradeCol: 'AL' },
                { name: 'Pendidikan Seni Visual', scoreCol: 'AG', gradeCol: 'AH' },
                { name: 'Pendidikan Jasmani dan Kesihatan', scoreCol: 'BK', gradeCol: 'BL' }
            ];
            
            subjects.forEach(subject => {
                const score = student[subject.scoreCol] || '';
                const grade = student[subject.gradeCol] || '';
                
                if (score || grade) {
                    const col = document.createElement('div');
                    col.className = 'col-md-6 col-lg-4';
                    
                    const card = document.createElement('div');
                    card.className = 'subject-card card p-3';
                    
                    card.innerHTML = `
                        <h5>${subject.name}</h5>
                        <div class="d-flex justify-content-between">
                            <div>
                                <small class="text-muted">Markah</small>
                                <p class="mb-0">${score}</p>
                            </div>
                            <div>
                                <small class="text-muted">Gred</small>
                                <p class="mb-0">${grade}</p>
                            </div>
                        </div>
                    `;
                    
                    col.appendChild(card);
                    subjectsContainer.appendChild(col);
                }
            });
            
            // Display analysis
            const analysisContainer = document.getElementById('analysisContainer');
            analysisContainer.innerHTML = '';
            
            const analysisData = [
                { title: 'Jumlah Markah', value: student.CA || 'N/A', icon: 'fa-calculator' },
                { title: 'Peratusan Purata', value: student.CB || 'N/A', icon: 'fa-percent' },
                { title: 'Gred Purata', value: student.CC || 'N/A', icon: 'fa-star' },
                { title: 'Keputusan Peperiksaan', value: student.CD || 'N/A', icon: 'fa-clipboard-check' },
                { title: 'Kedudukan Dalam Kelas', value: student.CU || 'N/A', icon: 'fa-users' },
                { title: 'Kedudukan Tahap', value: student.CZ || 'N/A', icon: 'fa-trophy' }
            ];
            
            analysisData.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';
                
                const card = document.createElement('div');
                card.className = 'analysis-card';
                
                card.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas ${item.icon} fa-2x me-3" style="color: var(--primary-color);"></i>
                        <div>
                            <h5 class="mb-1">${item.title}</h5>
                            <p class="mb-0 fs-4 fw-bold">${item.value}</p>
                        </div>
                    </div>
                `;
                
                col.appendChild(card);
                analysisContainer.appendChild(col);
            });
            
            // Display teacher's comment if available
            if (student.CV) {
                const commentCol = document.createElement('div');
                commentCol.className = 'col-12 mt-3';
                
                const commentCard = document.createElement('div');
                commentCard.className = 'analysis-card';
                
                commentCard.innerHTML = `
                    <h5><i class="fas fa-comment-dots me-2"></i> Ulasan Guru Kelas</h5>
                    <p class="mt-3">${student.CV}</p>
                `;
                
                commentCol.appendChild(commentCard);
                analysisContainer.appendChild(commentCol);
            }
            
            // Display additional analysis if available
            if (student.CF) {
                const analysisCol = document.createElement('div');
                analysisCol.className = 'col-12 mt-3';
                
                const analysisCard = document.createElement('div');
                analysisCard.className = 'analysis-card';
                
                analysisCard.innerHTML = `
                    <h5><i class="fas fa-chart-line me-2"></i> Analisis</h5>
                    <p class="mt-3">${student.CF}</p>
                `;
                
                analysisCol.appendChild(analysisCard);
                analysisContainer.appendChild(analysisCol);
            }
        }
        
        // Function to logout
        function logout() {
            icSection.style.display = 'none';
            resultsSection.style.display = 'none';
            loginSection.style.display = 'block';
            
            // Clear forms
            loginForm.reset();
            icForm.reset();
            
            currentStudent = null;
        }
        
        // Function to generate PDF
        function generatePDF() {
            const element = document.getElementById('resultsSection');
            
            html2canvas(element).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add new page if content is too long
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`Keputusan_Peperiksaan_${currentStudent.C || 'Pelajar'}.pdf`);
            });
        }
    </script>
</body>
</html>